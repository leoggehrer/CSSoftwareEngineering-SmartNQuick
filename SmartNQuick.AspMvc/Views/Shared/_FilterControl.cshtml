@*@BaseCode*@
@{
    @using SmartNQuick.AspMvc.Models.Modules.Common
    @using SmartNQuick.AspMvc.Models.Modules.View
    @using SmartNQuick.AspMvc.Modules.Language
    @using SmartNQuick.AspMvc.Modules.Session
    @using SmartNQuick.AspMvc.Modules.View
    @model IEnumerable<SmartNQuick.AspMvc.Models.IdentityModel>

    var viewBagWrapper = new ViewBagWrapper(ViewBag);
    var sessionWrapper = new SessionWrapper(Context.Session);

    viewBagWrapper.Translate = Translator.TranslateIt;
    viewBagWrapper.Controller = ViewContext.RouteData.Values["controller"].ToString();
    viewBagWrapper.Action = ViewContext.RouteData.Values["action"].ToString();

    var indexViewModel = default(IndexViewModel);

    if (Model is IEnumerable<IMasterDetails> mds)
    {
        if (mds.Any())
        {
            indexViewModel = viewBagWrapper.CreateIndexViewModel(new IdentityModel[] { mds.ElementAt(0).Master });
        }
    }
    else
    {
        indexViewModel = viewBagWrapper.CreateIndexViewModel(Model);
    }

    if (indexViewModel != null)
    {
        var filterModel = new FilterModel(sessionWrapper, viewBagWrapper, indexViewModel);

        <form asp-action="Filter" method="post">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
            @await Html.PartialAsync("_FilterModel", filterModel)
            @await Html.PartialAsync("_Submit", new SubmitCmd() { SubmitText = viewBagWrapper.TranslateFor("Apply") })
        </form>
    }
}
